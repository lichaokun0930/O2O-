# AI智能分析功能使用指南 (v2.0 深度版)

> **🎉 重大升级**: v2.0版本采用深度提示词工程,AI分析更准确、更具体、更有洞察力!

## 📋 功能概述

Dashboard已集成**GLM-4-Plus大模型**智能分析功能,可以:

- 🧠 **深度分析**:提取全部分类数据+衍生指标,不只是表面数据
- 💡 **真实洞察**:基于**具体数字**分析,拒绝空话套话
- 📊 **可执行建议**:分P0/P1/P2优先级,预估改善效果
- 🎯 **业务对标**:自动对比行业基准(动销率75%、滞销15%等)
- 📈 **量化评估**:计算TOP3集中度、健康分类数等关键指标

### ✨ v2.0 核心优化

1. **数据提取深度升级**
   - ✅ 全部分类数据(不只TOP10)
   - ✅ 自动计算促销强度、集中度、健康度
   - ✅ 百分比自动转换、数值预处理

2. **提示词工程优化**
   - 📊 数据预解读:标注健康线、对比基准
   - 🎯 强制要求:必须引用具体数字,禁止模糊表述
   - 📋 结构化输出:6大模块清晰分段
   - ⚠️ 质量控制:明确"什么是好的分析"

3. **输出能力增强**
   - Token上限: 8000 (原4096)
   - 温度参数: 0.8 (更具创造性)
   - 支持超长详细分析报告

---

## 🚀 快速开始

### 第一步:获取API密钥

1. 访问 https://open.bigmodel.cn
2. 注册/登录智谱AI账号
3. 进入"API Keys"页面
4. 点击"创建新的API密钥"
5. 复制生成的密钥(格式如:`abcd1234efgh5678...`)

### 第二步:配置API密钥

**方法1: 使用配置脚本(推荐)**

Windows CMD:
```cmd
设置AI密钥.bat
```

PowerShell:
```powershell
.\设置AI密钥.ps1
```

**方法2: 手动设置环境变量**

Windows PowerShell:
```powershell
[System.Environment]::SetEnvironmentVariable("ZHIPU_API_KEY", "你的API密钥", "User")
```

Windows CMD:
```cmd
setx ZHIPU_API_KEY "你的API密钥"
```

**重要**: 设置后需要**重启VS Code或PowerShell**才能生效!

### 第三步:测试AI功能

运行测试脚本验证配置:

```bash
.\.venv\Scripts\python.exe test_ai_analyzer.py
```

看到以下输出表示成功:
```
✅ API密钥已配置
✅ AI模块导入成功
✅ AI分析器初始化成功
✅ 所有测试通过! AI分析器工作正常
```

### 第四步:启动Dashboard

```bash
.\.venv\Scripts\python.exe dashboard_v2.py
```

访问: http://localhost:8055

---

## 💻 使用AI智能分析

### 在Dashboard中使用

1. **滚动到页面最底部**
   - 找到紫色渐变背景的"🤖 AI智能分析"区域

2. **点击"开始智能分析"按钮**
   - AI会自动收集当前看板的所有数据
   - 包括:KPI指标、分类数据、价格带、促销强度等

3. **等待分析完成**(通常10-30秒)
   - 显示进度提示:"AI正在分析数据,请稍候..."

4. **查看分析报告**
   - AI会生成包含以下内容的报告:
     - ✅ 整体经营诊断
     - ✅ 品类结构分析
     - ✅ 定价策略建议
     - ✅ 库存与动销优化
     - ✅ 商品运营策略
     - ✅ 具体行动计划

### 分类筛选分析

如果想针对特定分类进行深度分析:

1. 在页面顶部的"🔍 一级分类筛选"中选择分类
2. 然后再点击"开始智能分析"
3. AI会针对选定的分类进行专项分析

---

## 🎯 AI分析内容

### 1. 整体经营诊断
- 门店运营健康度评分
- 关键指标异常识别
- 潜在风险预警

### 2. 品类结构分析
- 各品类贡献度评估
- 品类组合优化建议
- 长尾品类处理策略

### 3. 定价策略建议
- 价格带分布合理性分析
- 促销力度评估
- 客单价提升方案

### 4. 库存与动销优化
- 滞销商品处理建议
- 库存周转改善方案
- 动销率提升策略

### 5. 商品运营策略
- 爆品打造建议
- SKU优化方案
- 多规格商品策略

### 6. 具体行动计划
- **近期**(1周内):3-5个可执行的改进措施
- **中期**(1个月):优化方向
- **长期**(季度):战略调整

---

## ⚙️ AI模型配置

### 使用的模型

- **模型**: GLM-4-Flash
- **提供商**: 智谱AI
- **特点**: 
  - 高性能、低延迟
  - 中英文理解能力强
  - 成本低廉(适合高频调用)

### 分析参数

- **Temperature**: 0.7(平衡精准性和创造性)
- **Max Tokens**: 4096(支持长篇分析报告)

### 业务上下文

AI已预置以下业务知识:

1. **O2O即时零售特点**
   - 30分钟-1小时送达
   - 高频复购
   - 价格敏感度高

2. **关键指标计算逻辑**
   - 动销率 = 动销SKU数 ÷ 去重SKU数 × 100%
   - 促销强度 = (10 - 折扣力度) ÷ 9 × 100%
   - 折扣占比 = 折扣SKU数 ÷ 去重SKU数 × 100%

3. **数据异常说明**
   - 折扣占比接近100%的原因
   - 活动占比全为100%的处理方式
   - 促销强度替代活动占比的逻辑

---

## ❓ 常见问题

### Q1: 点击按钮后显示"AI分析器未就绪"

**原因**: API密钥未正确配置

**解决**:
1. 检查是否已设置`ZHIPU_API_KEY`环境变量
2. 运行测试脚本:`python test_ai_analyzer.py`
3. 确认已重启VS Code/PowerShell

### Q2: 分析时间过长(>60秒)

**原因**: 网络连接问题或API服务繁忙

**解决**:
1. 检查网络连接
2. 稍后重试
3. 可能需要科学上网(部分地区)

### Q3: AI分析结果不够详细

**建议**:
1. 确保已上传完整的Excel报告
2. 使用分类筛选进行专项分析
3. 可以多次点击获取不同角度的分析

### Q4: API密钥安全吗?

**回答**:
- ✅ 密钥存储在系统环境变量中,其他程序无法访问
- ✅ 密钥不会出现在代码或日志中
- ✅ 建议定期更换API密钥
- ✅ 不要分享你的密钥给其他人

### Q5: 使用AI分析收费吗?

**回答**:
- 智谱AI采用**按量计费**模式
- 新用户通常有**免费额度**
- GLM-4-Flash非常便宜(约¥0.001/千token)
- 一次完整分析约消耗2000-4000 tokens(约¥0.002-0.004)
- 查看费用: https://open.bigmodel.cn/usercenter/billing

---

## 🔧 高级配置

### 修改AI模型

编辑`ai_analyzer.py`:

```python
# 改用更强大的模型(更贵)
self.model_name = 'glm-4-plus'  # 原为 'glm-4-flash'

# 改用更经济的模型(更便宜,效果稍弱)
self.model_name = 'glm-4-air'
```

### 调整分析温度

编辑`dashboard_v2.py`的`run_ai_analysis`函数:

```python
# 更精准(温度降低)
analysis_result = analyzer.analyze_dashboard_data(
    dashboard_data=dashboard_data,
    business_context=business_context,
    temperature=0.4  # 原为0.7
)

# 更有创造性(温度提高)
temperature=0.9
```

### 自定义业务上下文

编辑`ai_business_context.py`:

```python
BUSINESS_CONTEXT = """
【业务背景】
这是一个... (添加你的特定业务背景)

【关键指标】
自定义指标1: ...
自定义指标2: ...
"""
```

---

## 📚 技术架构

```
Dashboard (dashboard_v2.py)
    ↓
    调用 AI分析器 (ai_analyzer.py)
    ↓
    使用 业务上下文 (ai_business_context.py)
    ↓
    请求 GLM-4 API (智谱AI)
    ↓
    返回 分析报告
```

### 核心组件

1. **ai_analyzer.py**
   - AI分析器核心类
   - 支持多种AI模型
   - 错误处理和重试机制

2. **ai_business_context.py**
   - 业务领域知识库
   - KPI定义和计算逻辑
   - 数据质量说明

3. **dashboard_v2.py**
   - UI界面和交互
   - 数据收集和预处理
   - 结果展示

---

## 📈 后续优化方向

- [ ] 支持历史分析记录保存
- [ ] 支持对比分析(多门店/多时间段)
- [ ] 支持自定义分析维度
- [ ] 支持导出分析报告为PDF
- [ ] 支持语音输入分析需求
- [ ] 集成更多AI模型(GPT-4, Claude等)

---

## 📞 技术支持

如有问题,请检查:

1. ✅ `test_ai_analyzer.py` - 测试AI功能
2. ✅ `ai_analyzer.py` - 查看AI分析器日志
3. ✅ Dashboard控制台 - 查看错误信息

---

**版本**: v1.0
**更新日期**: 2025-01-XX
**模型**: GLM-4-Flash
**作者**: O2O数据分析团队
