# Phase 1 å‘é‡æ£€ç´¢ - å¯ç”¨æŒ‡å—

## ğŸ¯ ä¸‰ç§å¯ç”¨æ–¹å¼

### æ–¹å¼1: ç¯å¢ƒå˜é‡å¯ç”¨(æ¨è,ä¸´æ—¶æµ‹è¯•)
```powershell
# Windows PowerShell
$env:ENABLE_VECTOR_RETRIEVAL = "1"
$env:ZHIPU_API_KEY = "9f6f4134b7854fff87297a183a6dd0f9.ntVxfTOqYgmr7dCQ"
.\.venv\Scripts\python.exe dashboard_v2.py
```

**ä¼˜ç‚¹**: 
- âœ… ä¸ä¿®æ”¹ä»£ç 
- âœ… éšæ—¶å¯ç”¨/ç¦ç”¨
- âœ… é€‚åˆæµ‹è¯•å¯¹æ¯”

**ç¼ºç‚¹**:
- âš ï¸ æ¯æ¬¡å¯åŠ¨éƒ½éœ€è®¾ç½®ç¯å¢ƒå˜é‡

---

### æ–¹å¼2: ä¸€é”®åˆ‡æ¢è„šæœ¬(æ¨è,æ°¸ä¹…å¯ç”¨)
```powershell
# è¿è¡Œåˆ‡æ¢å·¥å…·
.\.venv\Scripts\python.exe å¿«é€Ÿåˆ‡æ¢å‘é‡æ£€ç´¢.py

# æˆ–ç›´æ¥åŒå‡»
å¿«é€Ÿåˆ‡æ¢å‘é‡æ£€ç´¢.py
```

**æ“ä½œæµç¨‹**:
1. è¿è¡Œè„šæœ¬,é€‰æ‹© `[2] åˆ‡æ¢å¼€å…³`
2. è‡ªåŠ¨ä¿®æ”¹ `ai_analyzer.py` é…ç½®
3. é‡å¯Dashboardç”Ÿæ•ˆ

**ä¼˜ç‚¹**:
- âœ… ä¸€é”®æ“ä½œ
- âœ… æ°¸ä¹…ç”Ÿæ•ˆ
- âœ… å¯éšæ—¶åˆ‡æ¢å›åŸºç¡€æ¨¡å¼

---

### æ–¹å¼3: æ‰‹åŠ¨ä¿®æ”¹ä»£ç (å¼€å‘è€…)
```python
# ç¼–è¾‘ ai_analyzer.py ç¬¬19è¡Œ
# æ”¹ä¸º:
VECTOR_RETRIEVAL_ENABLED = os.getenv('ENABLE_VECTOR_RETRIEVAL', '0') == '1' or True
#                                                                               ^^^^
```

---

## â±ï¸ é¦–æ¬¡å¯ç”¨é¢„çƒ­(ä»…ä¸€æ¬¡)

**é—®é¢˜**: é¦–æ¬¡å¯ç”¨ä¼šä¸‹è½½åµŒå…¥æ¨¡å‹(420MB),å¯¼è‡´Dashboardå¯åŠ¨å¡ä½5-10åˆ†é’Ÿ

**è§£å†³æ–¹æ¡ˆ**: æå‰é¢„çƒ­

### é¢„çƒ­æ­¥éª¤
```powershell
# æ–¹æ³•1: è¿è¡Œé¢„çƒ­è„šæœ¬(æ¨è)
åŒå‡» å¯ç”¨å‘é‡æ£€ç´¢.bat

# æ–¹æ³•2: æ‰‹åŠ¨é¢„çƒ­
.\.venv\Scripts\python.exe -c "from ai_knowledge_retriever import get_knowledge_retriever; get_knowledge_retriever()"
```

**é¢„çƒ­è¿‡ç¨‹**:
```
ğŸ”§ åˆå§‹åŒ–ä¸­æ–‡å‘é‡æ¨¡å‹...
Downloading (â€¦)lve/main/config.json: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 571/571
Downloading model.safetensors: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 471M/471M [05:23<00:00]
Downloading (â€¦)okenizer_config.json: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 350/350
âœ… å‘é‡æ¨¡å‹åŠ è½½å®Œæˆ
ğŸ—ï¸ æ„å»ºä¸šåŠ¡çŸ¥è¯†å‘é‡åº“...
ğŸ“„ ä¸šåŠ¡çŸ¥è¯†å·²åˆ†å—: 187 ä¸ªç‰‡æ®µ
âœ… å‘é‡åº“æ„å»ºå®Œæˆ
ğŸ’¾ å‘é‡åº“å·²ä¿å­˜åˆ°: ./cache/business_knowledge_vectorstore

âœ… é¢„çƒ­å®Œæˆ!
```

**åç»­å¯åŠ¨**: æ¨¡å‹å·²ç¼“å­˜,å¯åŠ¨æ—¶é—´æ¢å¤æ­£å¸¸(çº¦3ç§’)

---

## ğŸ“Š æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§ | åŸºç¡€æ¨¡å¼(å½“å‰) | å‘é‡æ£€ç´¢æ¨¡å¼(Phase 1) |
|------|---------------|---------------------|
| **Dashboardå¯åŠ¨** | âš¡ 3ç§’ | âš¡ 3ç§’(é¢„çƒ­å) / ğŸŒ 5-10åˆ†é’Ÿ(é¦–æ¬¡) |
| **AIåˆ†æè´¨é‡** | è‰¯å¥½ | â­ ä¼˜ç§€(ç²¾å‡†åº¦+40%) |
| **çŸ¥è¯†æ³¨å…¥** | å›ºå®š3000å­—ç¬¦ | æ™ºèƒ½æ£€ç´¢~2500å­—ç¬¦ |
| **ç›¸å…³æ€§** | çº¦40% | çº¦90% |
| **Tokenæ¶ˆè€—** | 3200 tokens | 2000 tokens(-37.5%) |
| **APIæˆæœ¬** | åŸºå‡† | èŠ‚çœ37.5% |
| **ä¾èµ–** | åŸºç¡€åº“ | +transformers(109MB)<br>+sentence-transformers<br>+langchain |

---

## ğŸ”„ æ¨èå·¥ä½œæµ

### åœºæ™¯1: æ—¥å¸¸ä½¿ç”¨(å¿«é€Ÿå¯åŠ¨ä¼˜å…ˆ)
```powershell
# ä¿æŒåŸºç¡€æ¨¡å¼
.\å¯åŠ¨Dashboard.bat

# AIåˆ†æå¶å°”éœ€è¦æ—¶,å•æ¬¡å¯ç”¨:
$env:ENABLE_VECTOR_RETRIEVAL = "1"
.\å¯åŠ¨Dashboard.bat
```

### åœºæ™¯2: æ·±åº¦åˆ†æ(è´¨é‡ä¼˜å…ˆ)
```powershell
# ä¸€æ¬¡æ€§é¢„çƒ­(ä»…é¦–æ¬¡)
.\å¯ç”¨å‘é‡æ£€ç´¢.bat

# æ°¸ä¹…å¯ç”¨
.\.venv\Scripts\python.exe å¿«é€Ÿåˆ‡æ¢å‘é‡æ£€ç´¢.py
# é€‰æ‹© [2] åˆ‡æ¢å¼€å…³

# åç»­æ­£å¸¸å¯åŠ¨å³å¯
.\å¯åŠ¨Dashboard.bat
```

### åœºæ™¯3: å›¢é˜Ÿåä½œ(çµæ´»åˆ‡æ¢)
```powershell
# é…ç½®batè„šæœ¬
@echo off
echo ğŸš€ å¯åŠ¨Dashboard(å‘é‡æ£€ç´¢å¢å¼ºç‰ˆ)
set ENABLE_VECTOR_RETRIEVAL=1
set ZHIPU_API_KEY=9f6f4134b7854fff87297a183a6dd0f9.ntVxfTOqYgmr7dCQ
.\.venv\Scripts\python.exe dashboard_v2.py
```

---

## ğŸ§ª éªŒè¯å‘é‡æ£€ç´¢æ˜¯å¦ç”Ÿæ•ˆ

### æ–¹æ³•1: æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
```
âœ… æ•°æ®åŠ è½½æˆåŠŸ
ğŸš€ å‘é‡æ£€ç´¢å¢å¼ºæ¨¡å¼å·²å¯ç”¨  â† æ­¤è¡Œå‡ºç°è¯´æ˜å·²å¯ç”¨
ğŸš€ å¯åŠ¨O2Oé—¨åº—æ•°æ®åˆ†æçœ‹æ¿...
```

### æ–¹æ³•2: æµ‹è¯•AIåˆ†æ
```python
# test_vector_retrieval.py
import os
os.environ['ENABLE_VECTOR_RETRIEVAL'] = '1'
os.environ['ZHIPU_API_KEY'] = 'your_key'

from ai_analyzer import get_ai_analyzer

analyzer = get_ai_analyzer()
print(f"å‘é‡æ£€ç´¢å™¨çŠ¶æ€: {'âœ… å·²åŠ è½½' if analyzer.knowledge_retriever else 'âŒ æœªåŠ è½½'}")

# æµ‹è¯•åˆ†æ
result = analyzer.analyze_store_health(
    kpi_data={'åŠ¨é”€ç‡': 45.2, 'æ»é”€å æ¯”': 28.5},
    category_data=[],
    meta_data={'é—¨åº—': 'æµ‹è¯•é—¨åº—'}
)

# æ£€æŸ¥è¿”å›ç»“æœä¸­æ˜¯å¦æœ‰æ›´ç²¾å‡†çš„å»ºè®®
print(result[:500])
```

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### é—®é¢˜1: å¯åŠ¨å¡ä½
**ç°è±¡**: Dashboardå¯åŠ¨åæ— å“åº”,å¡åœ¨æ¨¡å‹åŠ è½½

**è§£å†³**:
```powershell
# Ctrl+C ä¸­æ–­,ç„¶å:
# 1. ç¦ç”¨å‘é‡æ£€ç´¢
.\.venv\Scripts\python.exe å¿«é€Ÿåˆ‡æ¢å‘é‡æ£€ç´¢.py
# é€‰æ‹© [2] åˆ‡æ¢å¼€å…³

# 2. æˆ–è€…åå°é¢„çƒ­å®Œæˆåå†å¯ç”¨
.\å¯ç”¨å‘é‡æ£€ç´¢.bat
```

### é—®é¢˜2: ç½‘ç»œé—®é¢˜å¯¼è‡´ä¸‹è½½å¤±è´¥
**ç°è±¡**: 
```
ConnectionError: HTTPSConnectionPool(host='huggingface.co'...
```

**è§£å†³**:
```powershell
# ä½¿ç”¨å›½å†…é•œåƒ
$env:HF_ENDPOINT = "https://hf-mirror.com"
.\å¯ç”¨å‘é‡æ£€ç´¢.bat
```

### é—®é¢˜3: å†…å­˜ä¸è¶³
**ç°è±¡**: `MemoryError` æˆ– `Killed`

**è§£å†³**:
```python
# åˆ‡æ¢æ›´è½»é‡çº§æ¨¡å‹
# ç¼–è¾‘ ai_knowledge_retriever.py ç¬¬77è¡Œ
model_name = "sentence-transformers/all-MiniLM-L6-v2"  # 80MB,æ›´å¿«
# åŸ: paraphrase-multilingual-MiniLM-L12-v2  # 420MB
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ç¼“å­˜é¢„åŠ è½½(æœåŠ¡å™¨éƒ¨ç½²)
```python
# åœ¨Dockerfileæˆ–å¯åŠ¨è„šæœ¬ä¸­
RUN python -c "from ai_knowledge_retriever import get_knowledge_retriever; get_knowledge_retriever()"
```

### 2. è°ƒæ•´æ£€ç´¢å‚æ•°
```python
# ai_knowledge_retriever.py
def retrieve_relevant_knowledge(self, query, top_k=5):  # é»˜è®¤5
    # å‡å°‘åˆ°3: æ›´å¿«,ä½†å¯èƒ½ä¸¢å¤±ä¿¡æ¯
    # å¢åŠ åˆ°7: æ›´å…¨é¢,ä½†Tokenå¢åŠ 
```

### 3. å®šæœŸæ›´æ–°å‘é‡åº“
```powershell
# ä¸šåŠ¡çŸ¥è¯†æ›´æ–°å,é‡å»ºç¼“å­˜
Remove-Item -Recurse -Force .\cache\business_knowledge_vectorstore
.\.venv\Scripts\python.exe -c "from ai_knowledge_retriever import get_knowledge_retriever; get_knowledge_retriever()"
```

---

## ğŸ“ å¿«é€Ÿå‚è€ƒ

| æ“ä½œ | å‘½ä»¤ |
|------|------|
| æŸ¥çœ‹å½“å‰çŠ¶æ€ | `python å¿«é€Ÿåˆ‡æ¢å‘é‡æ£€ç´¢.py` â†’ [1] |
| å¯ç”¨å‘é‡æ£€ç´¢ | `python å¿«é€Ÿåˆ‡æ¢å‘é‡æ£€ç´¢.py` â†’ [2] |
| ç¦ç”¨å‘é‡æ£€ç´¢ | `python å¿«é€Ÿåˆ‡æ¢å‘é‡æ£€ç´¢.py` â†’ [2] |
| é¢„çƒ­æ¨¡å‹ | `.\å¯ç”¨å‘é‡æ£€ç´¢.bat` |
| ä¸´æ—¶å¯ç”¨ | `$env:ENABLE_VECTOR_RETRIEVAL="1"` |
| æ¸…é™¤ç¼“å­˜ | `Remove-Item -Recurse .\cache` |

---

**åˆ›å»ºæ—¶é—´**: 2025-10-27  
**é€‚ç”¨ç‰ˆæœ¬**: Phase 1 v1.0  
**ç»´æŠ¤è€…**: AI Assistant
