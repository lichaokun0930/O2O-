# 竞对门店数据手动上传功能使用指南 v2.3.0

## ✨ 新功能概述

**版本**: v2.3.0  
**发布日期**: 2025-10-27  
**核心改进**: 将竞对门店数据从自动加载改为手动上传模式

### 为什么要改成手动上传?

**之前的问题**:
- ❌ 自动扫描`reports`目录加载所有Excel文件
- ❌ 某些Excel文件存在openpyxl无法解析的损坏数据
- ❌ 加载过程中遇到损坏文件会导致Dashboard启动失败
- ❌ 用户无法控制加载哪些竞对门店

**现在的优势**:
- ✅ **Dashboard启动快速** - 不再在启动时加载任何竞对数据
- ✅ **用户自主选择** - 想对比哪个门店就上传哪个
- ✅ **避免损坏文件** - 坏文件只会影响单个上传,不影响整体
- ✅ **灵活对比** - 随时上传新的竞对数据进行对比

---

## 📖 使用步骤

### 第一步: 启动Dashboard

```powershell
cd "D:\Python1\O2O_Analysis\O2O数据分析\门店基础数据分析"
.\.venv\Scripts\python.exe dashboard_v2.py
```

或直接双击 `启动Dashboard.bat`

### 第二步: 打开浏览器访问

- **本地访问**: http://localhost:8055
- **局域网访问**: http://119.188.71.47:8055
- **外网访问**: https://2bn637md7241.vicp.fun

### 第三步: 进入"竞对对比"Tab

在Dashboard顶部导航栏找到 **"🏪 竞对对比"** 标签,点击进入。

### 第四步: 上传竞对Excel文件

在页面顶部会看到一个**蓝色虚线框**的上传区域:

```
┌────────────────────────────────────────────────┐
│  📤 上传竞对门店数据                            │
├────────────────────────────────────────────────┤
│                                                │
│         ☁️ 拖拽Excel文件到这里                 │
│             或 点击选择文件                     │
│                                                │
│       支持格式: .xlsx (竞对分析报告)            │
└────────────────────────────────────────────────┘
```

**两种上传方式**:
1. **拖拽**: 直接将Excel文件拖到蓝色框内
2. **点击**: 点击"点击选择文件"选择本地文件

**支持批量上传**: 可以一次选择多个Excel文件!

### 第五步: 查看上传结果

上传后,右侧会显示已上传的门店列表:

```
📋 已上传门店:
  ✅ 优购哆
  ✅ 惠宜选
  ✅ 星马快送
  
✅ 成功上传3个门店
```

如果某个文件损坏或格式错误,会显示:
```
  ❌ 中解去化: 加载失败
```

### 第六步: 选择要对比的门店

在下方的"选择门店"下拉框中:
1. 勾选想要对比的门店(2-8个)
2. 系统会自动更新以下图表:
   - 📊 KPI雷达图
   - 📈 商品角色堆叠图
   - 📊 分类对比柱状图
   - 💰 价格带对比折线图
   - 🏆 综合排名表

---

## 🎯 典型使用场景

### 场景1: 对比3家竞争门店

```
1. 上传: 优购哆.xlsx, 惠宜选.xlsx, 星马快送.xlsx
2. 选择: 全选这3家
3. 查看: KPI雷达图对比各家优劣势
```

### 场景2: 逐个添加竞对数据

```
1. 先上传: 优购哆.xlsx
2. 对比分析后,再上传: 惠宜选.xlsx
3. 继续上传: 星马快送.xlsx
4. 最终对比: 选择感兴趣的2-3家
```

### 场景3: 更换对比门店

```
1. 已上传5家门店
2. 先对比: 优购哆 vs 惠宜选
3. 再对比: 星马快送 vs 优鲸选
4. 无需重新上传,只需切换选择
```

---

## ⚠️ 注意事项

### Excel文件要求

**必须是通过`untitled1.py`生成的竞对分析报告**,包含以下Sheet:
- ✅ 核心指标对比
- ✅ 商品角色分析
- ✅ 价格带分析
- ✅ 美团一级分类详细指标

### 文件命名建议

**推荐格式**: `竞对分析报告_门店名.xlsx`

例如:
- ✅ `竞对分析报告_优购哆.xlsx`
- ✅ `竞对分析报告_惠宜选.xlsx`
- ✅ `竞对分析报告_星马快送.xlsx`

**避免使用**:
- ❌ 带时间戳: `竞对分析报告_v3.4_20251021_180508.xlsx`
- ❌ 临时文件: `~$竞对分析报告_优购哆.xlsx`

### 上传失败处理

如果某个文件上传失败:
1. 检查文件是否被Excel打开(关闭后重试)
2. 检查文件是否损坏(用Excel打开测试)
3. 尝试重新生成该报告文件
4. 跳过该文件,上传其他正常文件

---

## 🔧 常见问题

### Q1: 上传后下拉框没有显示门店?

**原因**: 文件可能加载失败  
**解决**: 查看右侧"已上传门店"区域,确认是否有 ❌ 标记

### Q2: 图表显示"请选择至少2个门店"?

**原因**: 选择的门店少于2个  
**解决**: 在下拉框中至少勾选2个门店

### Q3: 上传很多文件后Dashboard变慢?

**原因**: 内存中加载了过多数据  
**解决**: 
1. 刷新浏览器页面
2. 重新启动Dashboard
3. 只上传真正需要对比的门店数据

### Q4: 能否清除已上传的数据?

**当前版本**: 需要刷新页面或重启Dashboard  
**下一版本**: 将添加"清除全部"按钮

---

## 📊 数据说明

### 上传的数据存储在哪里?

- **内存中**: 上传的数据存储在Dashboard的内存变量`uploaded_stores`中
- **不写入磁盘**: 不会修改`reports`目录下的任何文件
- **刷新重置**: 刷新页面或重启Dashboard后需要重新上传

### 数据安全性

- ✅ 所有数据只在本地处理
- ✅ 不会上传到任何外部服务器
- ✅ 关闭Dashboard后数据自动清除

---

## 🚀 下一步优化计划

v2.4.0 计划功能:
- [ ] 添加"清除全部上传"按钮
- [ ] 显示每个门店的数据加载状态(加载中/成功/失败)
- [ ] 支持直接拖拽文件夹批量上传
- [ ] 保存上传配置(记住上次上传的门店列表)
- [ ] 添加文件验证(检查Sheet完整性)

---

## 📝 更新日志

### v2.3.0 (2025-10-27)
- ✨ **新增**: 手动上传竞对Excel文件功能
- ✨ **新增**: 实时显示已上传门店列表
- ✨ **新增**: 上传状态反馈(成功/失败计数)
- ✨ **优化**: Dashboard启动不再自动加载竞对数据
- 🐛 **修复**: 解决损坏Excel文件导致启动失败的问题
- 🐛 **修复**: 移除MultiStoreDataLoader自动扫描逻辑

### v2.2.3 (2025-10-27)
- 🐛 尝试修复: 添加异常捕获和空加载器降级

### v2.2.2 (2025-10-26)
- 🐛 修复: Windows UTF-8编码问题

---

## 💡 技术实现说明

### 核心改动

1. **全局变量**: `uploaded_stores = {}` 存储门店数据
2. **ManualMultiStoreLoader类**: 替代原有的MultiStoreDataLoader
3. **文件上传回调**: 处理base64解码和DataLoader实例化
4. **动态更新**: 上传后自动更新下拉框选项和默认值

### 代码位置

- **上传UI**: `dashboard_v2.py` 第4583-4627行
- **上传回调**: `dashboard_v2.py` 第6083-6164行
- **ManualMultiStoreLoader类**: `dashboard_v2.py` 第3956-3997行

---

**如有问题,请检查终端输出的错误信息或联系技术支持。**
