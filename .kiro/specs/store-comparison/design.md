# é—¨åº—å¯¹æ¯”åˆ†æåŠŸèƒ½è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°äº†é—¨åº—å¯¹æ¯”åˆ†æåŠŸèƒ½çš„æŠ€æœ¯è®¾è®¡æ–¹æ¡ˆã€‚è¯¥åŠŸèƒ½é€šè¿‡åœ¨ç°æœ‰å•åº—çœ‹æ¿ä¸­æ·»åŠ "å¯¹æ¯”æ¨¡å¼"ï¼Œå…è®¸ç”¨æˆ·é€‰æ‹©ç«å¯¹é—¨åº—ï¼Œå¹¶åœ¨å¡ç‰‡å†…å±•ç¤ºå¯¹æ¯”è§†å›¾ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿè¯†åˆ«ç»è¥å·®è·ã€‚

è®¾è®¡éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š
- **æœ€å°ä¾µå…¥**ï¼šåœ¨ç°æœ‰æ¶æ„ä¸Šæ‰©å±•ï¼Œä¸ç ´åå•åº—çœ‹æ¿åŠŸèƒ½
- **æ¸è¿›å¢å¼º**ï¼šä¼˜å…ˆå®ç°3ä¸ªæ ¸å¿ƒå¡ç‰‡ï¼Œåç»­é€æ­¥æ‰©å±•
- **æ€§èƒ½ä¼˜å…ˆ**ï¼šä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤åŠ è½½æ•°æ®
- **ç”¨æˆ·å‹å¥½**ï¼šå¹³æ»‘è¿‡æ¸¡ï¼Œæ¸…æ™°çš„è§†è§‰åé¦ˆ

## æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Dashboard Layout                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å¯¹æ¯”æ¨¡å¼æ§åˆ¶æ                                     â”‚  â”‚
â”‚  â”‚  [å¯¹æ¯”æ¨¡å¼: OFF/ON]  [é€‰æ‹©ç«å¯¹: Dropdown]         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å¡ç‰‡1: æ ¸å¿ƒæŒ‡æ ‡æ¦‚è§ˆ                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ å•åº—è§†å›¾ / å¯¹æ¯”è§†å›¾ (åŠ¨æ€åˆ‡æ¢)               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å¡ç‰‡2: ä¸€çº§åˆ†ç±»åŠ¨é”€åˆ†æ                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ å•åº—è§†å›¾ / å¯¹æ¯”è§†å›¾ (åŠ¨æ€åˆ‡æ¢)               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  ... (å…¶ä»–å¡ç‰‡)                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµè®¾è®¡

```
ç”¨æˆ·æ“ä½œ                Dashå›è°ƒ                æ•°æ®å¤„ç†
   â”‚                      â”‚                       â”‚
   â”œâ”€ å¼€å¯å¯¹æ¯”æ¨¡å¼ â”€â”€â”€â”€â†’  â”‚                       â”‚
   â”‚                      â”œâ”€ æ›´æ–°UIçŠ¶æ€ â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
   â”‚                      â”‚   (å¯ç”¨ç«å¯¹é€‰æ‹©å™¨)     â”‚
   â”‚                      â”‚                       â”‚
   â”œâ”€ é€‰æ‹©ç«å¯¹é—¨åº— â”€â”€â”€â”€â†’  â”‚                       â”‚
   â”‚                      â”œâ”€ åŠ è½½ç«å¯¹æ•°æ® â”€â”€â”€â”€â”€â”€â†’ â”‚
   â”‚                      â”‚                       â”œâ”€ æ£€æŸ¥ç¼“å­˜
   â”‚                      â”‚                       â”œâ”€ è¯»å–Excel
   â”‚                      â”‚                       â”œâ”€ è§£ææ•°æ®
   â”‚                      â”‚                       â””â”€ è¿”å›æ•°æ®
   â”‚                      â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                      â”œâ”€ å­˜å‚¨åˆ°Storeç»„ä»¶
   â”‚                      â”‚
   â”‚                      â”œâ”€ è§¦å‘å¡ç‰‡æ›´æ–° â”€â”€â”€â”€â”€â”€â†’ â”‚
   â”‚                      â”‚                       â”œâ”€ è·å–æœ¬åº—æ•°æ®
   â”‚                      â”‚                       â”œâ”€ è·å–ç«å¯¹æ•°æ®
   â”‚                      â”‚                       â”œâ”€ ç”Ÿæˆå¯¹æ¯”å›¾è¡¨
   â”‚                      â”‚                       â”œâ”€ ç”Ÿæˆå·®å¼‚åˆ†æ
   â”‚                      â”‚                       â””â”€ è¿”å›å¯¹æ¯”è§†å›¾
   â”‚                      â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚ â†â”€ æ˜¾ç¤ºå¯¹æ¯”è§†å›¾ â”€â”€â”€â”€â”˜
```

### çŠ¶æ€ç®¡ç†

ä½¿ç”¨Dashçš„`dcc.Store`ç»„ä»¶ç®¡ç†å…¨å±€çŠ¶æ€ï¼š

```python
# å¯¹æ¯”æ¨¡å¼çŠ¶æ€
dcc.Store(id='comparison-mode', data='off')  # 'off' | 'on'

# é€‰ä¸­çš„ç«å¯¹é—¨åº—
dcc.Store(id='selected-competitor', data=None)  # é—¨åº—åç§°

# ç«å¯¹æ•°æ®ç¼“å­˜
dcc.Store(id='competitor-data-cache', data={})  # {kpi: {...}, category: [...], ...}

# å¯¹æ¯”è§†å›¾çŠ¶æ€ï¼ˆæ¯ä¸ªå¡ç‰‡ï¼‰
dcc.Store(id='card-view-mode', data={
    'kpi': 'single',           # 'single' | 'comparison'
    'category': 'single',
    'multispec': 'single'
})
```

## ç»„ä»¶è®¾è®¡

### 1. å¯¹æ¯”æ¨¡å¼æ§åˆ¶æ ç»„ä»¶

**ç»„ä»¶åç§°**: `ComparisonModeControl`

**åŠŸèƒ½**: æä¾›å¯¹æ¯”æ¨¡å¼å¼€å…³å’Œç«å¯¹é€‰æ‹©å™¨

**å¸ƒå±€**:
```python
html.Div([
    dbc.Row([
        dbc.Col([
            html.Label("å¯¹æ¯”æ¨¡å¼:", style={'fontWeight': '600', 'marginRight': '10px'}),
            dbc.Switch(
                id='comparison-mode-switch',
                value=False,
                label="OFF",
                style={'display': 'inline-block'}
            )
        ], width=3),
        
        dbc.Col([
            html.Label("é€‰æ‹©ç«å¯¹:", style={'fontWeight': '600', 'marginRight': '10px'}),
            dcc.Dropdown(
                id='competitor-selector',
                options=[],  # åŠ¨æ€åŠ è½½å·²ä¸Šä¼ çš„é—¨åº—
                value=None,
                placeholder="è¯·é€‰æ‹©ç«å¯¹é—¨åº—",
                disabled=True,  # åˆå§‹ç¦ç”¨
                style={'width': '300px'}
            )
        ], width=6)
    ], align='center', style={'padding': '15px', 'backgroundColor': '#f8f9fa', 'borderRadius': '8px'})
], id='comparison-control-bar', style={'marginBottom': '20px'})
```

**å›è°ƒé€»è¾‘**:
```python
@app.callback(
    [Output('competitor-selector', 'disabled'),
     Output('competitor-selector', 'options'),
     Output('comparison-mode-switch', 'label')],
    Input('comparison-mode-switch', 'value')
)
def update_comparison_control(mode_on):
    """æ›´æ–°å¯¹æ¯”æ¨¡å¼æ§åˆ¶æ çŠ¶æ€"""
    if mode_on:
        # è·å–å·²ä¸Šä¼ çš„é—¨åº—åˆ—è¡¨ï¼ˆæ’é™¤å½“å‰é—¨åº—ï¼‰
        options = get_uploaded_stores_except_current()
        return False, options, "ON"
    else:
        return True, [], "OFF"
```

### 2. å¯¹æ¯”æ•°æ®åŠ è½½å™¨

**ç»„ä»¶åç§°**: `ComparisonDataLoader`

**åŠŸèƒ½**: åŠ è½½å’Œç¼“å­˜ç«å¯¹é—¨åº—æ•°æ®

**å®ç°**:
```python
class ComparisonDataLoader:
    """å¯¹æ¯”æ•°æ®åŠ è½½å™¨"""
    
    def __init__(self):
        self.cache = {}  # {store_name: DataLoader}
    
    def load_competitor_data(self, store_name):
        """åŠ è½½ç«å¯¹æ•°æ®ï¼ˆå¸¦ç¼“å­˜ï¼‰"""
        # æ£€æŸ¥ç¼“å­˜
        if store_name in self.cache:
            logger.info(f"âœ… ä½¿ç”¨ç¼“å­˜çš„ç«å¯¹æ•°æ®: {store_name}")
            return self.cache[store_name]
        
        # è·å–é—¨åº—æŠ¥å‘Šè·¯å¾„
        report_path = store_manager.get_report_path(store_name)
        if not report_path or not Path(report_path).exists():
            logger.error(f"âŒ ç«å¯¹æŠ¥å‘Šä¸å­˜åœ¨: {store_name}")
            return None
        
        # åŠ è½½æ•°æ®
        logger.info(f"ğŸ“‚ åŠ è½½ç«å¯¹æ•°æ®: {store_name}")
        data_loader = DataLoader(report_path, use_cache=True)
        
        # ç¼“å­˜æ•°æ®
        self.cache[store_name] = data_loader
        return data_loader
    
    def clear_cache(self, store_name=None):
        """æ¸…é™¤ç¼“å­˜"""
        if store_name:
            self.cache.pop(store_name, None)
        else:
            self.cache.clear()

# å…¨å±€å®ä¾‹
comparison_loader = ComparisonDataLoader()
```

**å›è°ƒé€»è¾‘**:
```python
@app.callback(
    Output('competitor-data-cache', 'data'),
    Input('competitor-selector', 'value'),
    prevent_initial_call=True
)
def load_competitor_data(competitor_name):
    """åŠ è½½ç«å¯¹æ•°æ®"""
    if not competitor_name:
        return {}
    
    # åŠ è½½æ•°æ®
    data_loader = comparison_loader.load_competitor_data(competitor_name)
    if not data_loader:
        return {}
    
    # æå–å…³é”®æ•°æ®
    return {
        'kpi': data_loader.get_kpi_summary(),
        'category': data_loader.get_category_analysis().to_dict('records'),
        'price': data_loader.get_price_analysis().to_dict('records'),
        'role': data_loader.get_role_analysis().to_dict('records')
    }
```

### 3. å¯¹æ¯”å›¾è¡¨ç”Ÿæˆå™¨

**ç»„ä»¶åç§°**: `ComparisonChartBuilder`

**åŠŸèƒ½**: ç”Ÿæˆå„ç§å¯¹æ¯”å›¾è¡¨

**å®ç°**:
```python
class ComparisonChartBuilder:
    """å¯¹æ¯”å›¾è¡¨ç”Ÿæˆå™¨"""
    
    @staticmethod
    def create_grouped_bar_chart(own_data, competitor_data, x_col, y_col, title):
        """åˆ›å»ºåˆ†ç»„æŸ±çŠ¶å›¾"""
        import plotly.graph_objects as go
        
        fig = go.Figure()
        
        # æœ¬åº—æ•°æ®
        fig.add_trace(go.Bar(
            name='æœ¬åº—',
            x=own_data[x_col],
            y=own_data[y_col],
            marker_color='#3498db',
            text=own_data[y_col],
            textposition='outside'
        ))
        
        # ç«å¯¹æ•°æ®
        fig.add_trace(go.Bar(
            name='ç«å¯¹',
            x=competitor_data[x_col],
            y=competitor_data[y_col],
            marker_color='#e74c3c',
            text=competitor_data[y_col],
            textposition='outside'
        ))
        
        fig.update_layout(
            title=title,
            barmode='group',
            xaxis_title=x_col,
            yaxis_title=y_col,
            legend=dict(orientation='h', yanchor='bottom', y=1.02, xanchor='right', x=1),
            height=400
        )
        
        return fig
    
    @staticmethod
    def create_mirror_bar_chart(own_data, competitor_data, category_col, value_col, title):
        """åˆ›å»ºé•œåƒæŸ±çŠ¶å›¾"""
        import plotly.graph_objects as go
        
        fig = go.Figure()
        
        # æœ¬åº—æ•°æ®ï¼ˆè´Ÿå€¼ï¼Œæ˜¾ç¤ºåœ¨å·¦ä¾§ï¼‰
        fig.add_trace(go.Bar(
            name='æœ¬åº—',
            y=own_data[category_col],
            x=-own_data[value_col],  # è´Ÿå€¼
            orientation='h',
            marker_color='#3498db',
            text=own_data[value_col],
            textposition='outside',
            hovertemplate='%{y}: %{text}<extra></extra>'
        ))
        
        # ç«å¯¹æ•°æ®ï¼ˆæ­£å€¼ï¼Œæ˜¾ç¤ºåœ¨å³ä¾§ï¼‰
        fig.add_trace(go.Bar(
            name='ç«å¯¹',
            y=competitor_data[category_col],
            x=competitor_data[value_col],
            orientation='h',
            marker_color='#e74c3c',
            text=competitor_data[value_col],
            textposition='outside',
            hovertemplate='%{y}: %{text}<extra></extra>'
        ))
        
        fig.update_layout(
            title=title,
            barmode='overlay',
            xaxis=dict(
                title=value_col,
                tickvals=[-30, -20, -10, 0, 10, 20, 30],
                ticktext=['30', '20', '10', '0', '10', '20', '30']
            ),
            yaxis_title=category_col,
            legend=dict(orientation='h', yanchor='bottom', y=1.02, xanchor='right', x=1),
            height=500
        )
        
        return fig
    
    @staticmethod
    def create_stacked_comparison_bar(own_data, competitor_data, title):
        """åˆ›å»ºå †å å¯¹æ¯”æŸ±çŠ¶å›¾"""
        import plotly.graph_objects as go
        
        fig = go.Figure()
        
        # æœ¬åº—å †å æ¡
        fig.add_trace(go.Bar(
            name='æœ¬åº—-å•è§„æ ¼',
            y=['æœ¬åº—'],
            x=[own_data['single_spec_pct']],
            orientation='h',
            marker_color='#3498db',
            text=[f"{own_data['single_spec_pct']:.1%}"],
            textposition='inside'
        ))
        
        fig.add_trace(go.Bar(
            name='æœ¬åº—-å¤šè§„æ ¼',
            y=['æœ¬åº—'],
            x=[own_data['multi_spec_pct']],
            orientation='h',
            marker_color='#5dade2',
            text=[f"{own_data['multi_spec_pct']:.1%}"],
            textposition='inside'
        ))
        
        # ç«å¯¹å †å æ¡
        fig.add_trace(go.Bar(
            name='ç«å¯¹-å•è§„æ ¼',
            y=['ç«å¯¹'],
            x=[competitor_data['single_spec_pct']],
            orientation='h',
            marker_color='#e74c3c',
            text=[f"{competitor_data['single_spec_pct']:.1%}"],
            textposition='inside'
        ))
        
        fig.add_trace(go.Bar(
            name='ç«å¯¹-å¤šè§„æ ¼',
            y=['ç«å¯¹'],
            x=[competitor_data['multi_spec_pct']],
            orientation='h',
            marker_color='#ec7063',
            text=[f"{competitor_data['multi_spec_pct']:.1%}"],
            textposition='inside'
        ))
        
        fig.update_layout(
            title=title,
            barmode='stack',
            xaxis=dict(title='å æ¯”', tickformat='.0%'),
            showlegend=True,
            legend=dict(orientation='h', yanchor='bottom', y=1.02, xanchor='right', x=1),
            height=200
        )
        
        return fig
    
    @staticmethod
    def create_radar_chart(own_kpi, competitor_kpi, metrics):
        """åˆ›å»ºé›·è¾¾å›¾"""
        import plotly.graph_objects as go
        
        # å½’ä¸€åŒ–æ•°æ®ï¼ˆ0-100ï¼‰
        own_values = []
        competitor_values = []
        
        for metric in metrics:
            own_val = own_kpi.get(metric, 0)
            comp_val = competitor_kpi.get(metric, 0)
            max_val = max(own_val, comp_val) or 1
            
            own_values.append((own_val / max_val) * 100)
            competitor_values.append((comp_val / max_val) * 100)
        
        fig = go.Figure()
        
        # æœ¬åº—é›·è¾¾
        fig.add_trace(go.Scatterpolar(
            r=own_values,
            theta=metrics,
            fill='toself',
            name='æœ¬åº—',
            line_color='#3498db'
        ))
        
        # ç«å¯¹é›·è¾¾
        fig.add_trace(go.Scatterpolar(
            r=competitor_values,
            theta=metrics,
            fill='toself',
            name='ç«å¯¹',
            line_color='#e74c3c'
        ))
        
        fig.update_layout(
            polar=dict(radialaxis=dict(visible=True, range=[0, 100])),
            showlegend=True,
            height=400
        )
        
        return fig

# å…¨å±€å®ä¾‹
chart_builder = ComparisonChartBuilder()
```

### 4. å·®å¼‚åˆ†æç”Ÿæˆå™¨

**ç»„ä»¶åç§°**: `DifferenceAnalyzer`

**åŠŸèƒ½**: è‡ªåŠ¨ç”Ÿæˆå·®å¼‚åˆ†ææ´å¯Ÿ

**å®ç°**:
```python
class DifferenceAnalyzer:
    """å·®å¼‚åˆ†æç”Ÿæˆå™¨"""
    
    @staticmethod
    def analyze_kpi_differences(own_kpi, competitor_kpi):
        """åˆ†æKPIå·®å¼‚"""
        insights = []
        
        # å®šä¹‰å…³é”®æŒ‡æ ‡
        key_metrics = [
            {'key': 'æ€»é”€å”®é¢(å»é‡å)', 'name': 'é”€å”®é¢', 'format': 'currency', 'higher_is_better': True},
            {'key': 'æ€»SKUæ•°(å»é‡å)', 'name': 'SKUæ•°', 'format': 'number', 'higher_is_better': True},
            {'key': 'åŠ¨é”€ç‡', 'name': 'åŠ¨é”€ç‡', 'format': 'percent', 'higher_is_better': True},
            {'key': 'å¹³å‡æ¯›åˆ©ç‡', 'name': 'æ¯›åˆ©ç‡', 'format': 'percent', 'higher_is_better': True}
        ]
        
        for metric in key_metrics:
            own_val = own_kpi.get(metric['key'], 0)
            comp_val = competitor_kpi.get(metric['key'], 0)
            
            if comp_val == 0:
                continue
            
            diff = own_val - comp_val
            diff_pct = (diff / comp_val) * 100
            
            # åªæœ‰ç«å¯¹é¢†å…ˆæ—¶æ‰ç”Ÿæˆæ´å¯Ÿ
            if comp_val > own_val:
                if metric['format'] == 'currency':
                    insight_text = f"ç«å¯¹çš„{metric['name']}æ¯”æœ¬åº—é«˜ Â¥{abs(diff):,.0f}ï¼ˆ{abs(diff_pct):.1f}%ï¼‰"
                elif metric['format'] == 'percent':
                    insight_text = f"ç«å¯¹çš„{metric['name']}æ¯”æœ¬åº—é«˜ {abs(diff):.1%}ï¼ˆ{abs(diff_pct):.1f}%ï¼‰"
                else:
                    insight_text = f"ç«å¯¹çš„{metric['name']}æ¯”æœ¬åº—å¤š {abs(diff):,.0f}ä¸ªï¼ˆ{abs(diff_pct):.1f}%ï¼‰"
                
                insights.append({
                    'icon': 'âš ï¸',
                    'text': insight_text,
                    'level': 'warning'
                })
        
        return insights[:3]  # æœ€å¤šè¿”å›3æ¡
    
    @staticmethod
    def analyze_category_differences(own_category, competitor_category):
        """åˆ†æåˆ†ç±»å·®å¼‚"""
        insights = []
        
        # è½¬æ¢ä¸ºDataFrame
        own_df = pd.DataFrame(own_category)
        comp_df = pd.DataFrame(competitor_category)
        
        if own_df.empty or comp_df.empty:
            return insights
        
        # å‡è®¾ç¬¬ä¸€åˆ—æ˜¯åˆ†ç±»åï¼Œç¬¬äºŒåˆ—æ˜¯SKUæ•°
        category_col = own_df.columns[0]
        sku_col = own_df.columns[1] if len(own_df.columns) > 1 else None
        
        if not sku_col:
            return insights
        
        # åˆå¹¶æ•°æ®
        merged = pd.merge(
            own_df[[category_col, sku_col]],
            comp_df[[category_col, sku_col]],
            on=category_col,
            how='outer',
            suffixes=('_own', '_comp')
        ).fillna(0)
        
        # è®¡ç®—å·®å¼‚
        merged['diff'] = merged[f'{sku_col}_comp'] - merged[f'{sku_col}_own']
        merged['diff_pct'] = (merged['diff'] / merged[f'{sku_col}_comp']) * 100
        
        # æ‰¾å‡ºç«å¯¹é¢†å…ˆçš„åˆ†ç±»
        competitor_leading = merged[merged['diff'] > 0].nlargest(3, 'diff')
        
        for _, row in competitor_leading.iterrows():
            category = row[category_col]
            own_sku = row[f'{sku_col}_own']
            comp_sku = row[f'{sku_col}_comp']
            
            if comp_sku > 0:
                ratio = comp_sku / own_sku if own_sku > 0 else float('inf')
                if ratio == float('inf'):
                    insight_text = f"ç«å¯¹åœ¨"{category}"æœ‰{comp_sku:.0f}ä¸ªSKUï¼Œæœ¬åº—ä¸º0"
                else:
                    insight_text = f"ç«å¯¹åœ¨"{category}"çš„SKUæ•°æ˜¯æœ¬åº—çš„{ratio:.1f}å€ï¼ˆ{comp_sku:.0f} vs {own_sku:.0f}ï¼‰"
                
                insights.append({
                    'icon': 'ğŸ“Š',
                    'text': insight_text,
                    'level': 'info'
                })
        
        return insights[:3]
    
    @staticmethod
    def generate_recommendations(insights):
        """ç”Ÿæˆæ”¹è¿›å»ºè®®"""
        recommendations = []
        
        for insight in insights:
            text = insight['text']
            
            # åŸºäºæ´å¯Ÿç”Ÿæˆå»ºè®®
            if 'SKUæ•°' in text or 'SKU' in text:
                recommendations.append({
                    'icon': 'ğŸ’¡',
                    'text': 'å»ºè®®ï¼šå¢åŠ è¯¥åˆ†ç±»çš„å•†å“æ•°é‡ï¼Œæå‡å“ç±»ä¸°å¯Œåº¦',
                    'level': 'success'
                })
            elif 'åŠ¨é”€ç‡' in text:
                recommendations.append({
                    'icon': 'ğŸ’¡',
                    'text': 'å»ºè®®ï¼šä¼˜åŒ–æ»é”€å•†å“ï¼Œæå‡æ•´ä½“åŠ¨é”€ç‡',
                    'level': 'success'
                })
            elif 'é”€å”®é¢' in text:
                recommendations.append({
                    'icon': 'ğŸ’¡',
                    'text': 'å»ºè®®ï¼šåŠ å¤§ä¿ƒé”€åŠ›åº¦ï¼Œæå‡é”€å”®é¢',
                    'level': 'success'
                })
        
        return recommendations[:2]  # æœ€å¤šè¿”å›2æ¡å»ºè®®

# å…¨å±€å®ä¾‹
analyzer = DifferenceAnalyzer()
```

## æ•°æ®æ¨¡å‹

### å¯¹æ¯”æ•°æ®ç»“æ„

```python
# æœ¬åº—æ•°æ®ï¼ˆä»å½“å‰DataLoaderè·å–ï¼‰
own_data = {
    'kpi': {
        'æ€»é”€å”®é¢(å»é‡å)': 500000,
        'æ€»SKUæ•°(å»é‡å)': 120,
        'åŠ¨é”€ç‡': 0.65,
        'å¹³å‡æ¯›åˆ©ç‡': 0.32,
        ...
    },
    'category': [
        {'åˆ†ç±»': 'æœé¥°é‹åŒ…', 'SKUæ•°': 10, 'åŠ¨é”€ç‡': 0.65, 'é”€å”®é¢': 50000},
        {'åˆ†ç±»': 'é£Ÿå“é¥®æ–™', 'SKUæ•°': 45, 'åŠ¨é”€ç‡': 0.78, 'é”€å”®é¢': 120000},
        ...
    ],
    'price': [...],
    'role': [...]
}

# ç«å¯¹æ•°æ®ï¼ˆä»ComparisonDataLoaderè·å–ï¼‰
competitor_data = {
    'kpi': {
        'æ€»é”€å”®é¢(å»é‡å)': 680000,
        'æ€»SKUæ•°(å»é‡å)': 180,
        'åŠ¨é”€ç‡': 0.72,
        'å¹³å‡æ¯›åˆ©ç‡': 0.28,
        ...
    },
    'category': [
        {'åˆ†ç±»': 'æœé¥°é‹åŒ…', 'SKUæ•°': 20, 'åŠ¨é”€ç‡': 0.72, 'é”€å”®é¢': 80000},
        {'åˆ†ç±»': 'é£Ÿå“é¥®æ–™', 'SKUæ•°': 38, 'åŠ¨é”€ç‡': 0.70, 'é”€å”®é¢': 150000},
        ...
    ],
    'price': [...],
    'role': [...]
}
```

## é”™è¯¯å¤„ç†

### é”™è¯¯åœºæ™¯ä¸å¤„ç†ç­–ç•¥

| é”™è¯¯åœºæ™¯ | å¤„ç†ç­–ç•¥ |
|---------|---------|
| ç«å¯¹æŠ¥å‘Šä¸å­˜åœ¨ | æ˜¾ç¤ºé”™è¯¯æç¤ºï¼Œç¦ç”¨å¯¹æ¯”æ¨¡å¼ |
| ç«å¯¹æ•°æ®åŠ è½½å¤±è´¥ | æ˜¾ç¤ºé”™è¯¯æç¤ºï¼Œä¿æŒå•åº—è§†å›¾ |
| ç«å¯¹æ•°æ®æ ¼å¼ä¸åŒ¹é… | æ˜¾ç¤ºè­¦å‘Šï¼Œè·³è¿‡ä¸åŒ¹é…çš„å­—æ®µ |
| å›¾è¡¨æ¸²æŸ“å¤±è´¥ | æ˜¾ç¤º"å›¾è¡¨åŠ è½½å¤±è´¥"ï¼Œè®°å½•é”™è¯¯æ—¥å¿— |
| å·®å¼‚åˆ†æç”Ÿæˆå¤±è´¥ | è·³è¿‡å·®å¼‚åˆ†æï¼Œåªæ˜¾ç¤ºå›¾è¡¨ |

### é”™è¯¯æ—¥å¿—

```python
# ä½¿ç”¨ç°æœ‰çš„loggerç³»ç»Ÿ
logger.error(f"âŒ ç«å¯¹æ•°æ®åŠ è½½å¤±è´¥: {competitor_name}, é”™è¯¯: {e}")
logger.warning(f"âš ï¸ ç«å¯¹æ•°æ®å­—æ®µç¼ºå¤±: {missing_fields}")
logger.info(f"âœ… å¯¹æ¯”è§†å›¾æ¸²æŸ“æˆåŠŸ: {card_name}")
```

## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼š

```python
# test_comparison_data_loader.py
def test_load_competitor_data():
    """æµ‹è¯•ç«å¯¹æ•°æ®åŠ è½½"""
    loader = ComparisonDataLoader()
    data = loader.load_competitor_data('ç«å¯¹é—¨åº—A')
    assert data is not None
    assert 'kpi' in data
    assert 'category' in data

def test_cache_mechanism():
    """æµ‹è¯•ç¼“å­˜æœºåˆ¶"""
    loader = ComparisonDataLoader()
    data1 = loader.load_competitor_data('ç«å¯¹é—¨åº—A')
    data2 = loader.load_competitor_data('ç«å¯¹é—¨åº—A')
    assert data1 is data2  # åº”è¯¥è¿”å›åŒä¸€ä¸ªå¯¹è±¡

# test_comparison_chart_builder.py
def test_create_grouped_bar_chart():
    """æµ‹è¯•åˆ†ç»„æŸ±çŠ¶å›¾ç”Ÿæˆ"""
    own_data = pd.DataFrame({'åˆ†ç±»': ['A', 'B'], 'SKUæ•°': [10, 20]})
    comp_data = pd.DataFrame({'åˆ†ç±»': ['A', 'B'], 'SKUæ•°': [15, 25]})
    fig = chart_builder.create_grouped_bar_chart(own_data, comp_data, 'åˆ†ç±»', 'SKUæ•°', 'æµ‹è¯•')
    assert fig is not None
    assert len(fig.data) == 2  # ä¸¤æ¡trace

# test_difference_analyzer.py
def test_analyze_kpi_differences():
    """æµ‹è¯•KPIå·®å¼‚åˆ†æ"""
    own_kpi = {'æ€»é”€å”®é¢(å»é‡å)': 500000, 'æ€»SKUæ•°(å»é‡å)': 120}
    comp_kpi = {'æ€»é”€å”®é¢(å»é‡å)': 680000, 'æ€»SKUæ•°(å»é‡å)': 180}
    insights = analyzer.analyze_kpi_differences(own_kpi, comp_kpi)
    assert len(insights) > 0
    assert 'ç«å¯¹' in insights[0]['text']
```

### é›†æˆæµ‹è¯•

æµ‹è¯•å®Œæ•´çš„å¯¹æ¯”æµç¨‹ï¼š

```python
# test_comparison_integration.py
def test_comparison_mode_workflow():
    """æµ‹è¯•å¯¹æ¯”æ¨¡å¼å®Œæ•´æµç¨‹"""
    # 1. å¼€å¯å¯¹æ¯”æ¨¡å¼
    # 2. é€‰æ‹©ç«å¯¹é—¨åº—
    # 3. åŠ è½½ç«å¯¹æ•°æ®
    # 4. æ¸²æŸ“å¯¹æ¯”è§†å›¾
    # 5. ç”Ÿæˆå·®å¼‚åˆ†æ
    # 6. å…³é—­å¯¹æ¯”æ¨¡å¼
    pass
```

### æ€§èƒ½æµ‹è¯•

æµ‹è¯•æ•°æ®åŠ è½½å’Œæ¸²æŸ“æ€§èƒ½ï¼š

```python
# test_comparison_performance.py
def test_data_loading_performance():
    """æµ‹è¯•æ•°æ®åŠ è½½æ€§èƒ½"""
    import time
    start = time.time()
    loader = ComparisonDataLoader()
    data = loader.load_competitor_data('ç«å¯¹é—¨åº—A')
    elapsed = time.time() - start
    assert elapsed < 2.0  # åº”è¯¥åœ¨2ç§’å†…å®Œæˆ

def test_chart_rendering_performance():
    """æµ‹è¯•å›¾è¡¨æ¸²æŸ“æ€§èƒ½"""
    import time
    start = time.time()
    fig = chart_builder.create_grouped_bar_chart(own_data, comp_data, 'åˆ†ç±»', 'SKUæ•°', 'æµ‹è¯•')
    elapsed = time.time() - start
    assert elapsed < 0.5  # åº”è¯¥åœ¨0.5ç§’å†…å®Œæˆ
```



## æ­£ç¡®æ€§å±æ€§

*A property is a characteristic or behavior that should hold true across all valid executions of a system-essentially, a formal statement about what the system should do. Properties serve as the bridge between human-readable specifications and machine-verifiable correctness guarantees.*

### Property 1: å¯¹æ¯”æ¨¡å¼çŠ¶æ€ä¸€è‡´æ€§
*For any* Dashboard state, when comparison mode is OFF, the competitor selector should be disabled, and when comparison mode is ON, the competitor selector should be enabled.
**Validates: Requirements 1.2, 1.3**

### Property 2: å¯¹æ¯”æ¨¡å¼åˆ‡æ¢çš„å¯é€†æ€§ï¼ˆRound Tripï¼‰
*For any* Dashboard state, enabling comparison mode then disabling it should restore the original single-store view state.
**Validates: Requirements 1.5**

### Property 3: ç«å¯¹æ•°æ®åŠ è½½è§¦å‘
*For any* valid competitor store selection, the Dashboard should trigger data loading and switch all supported cards to comparison view.
**Validates: Requirements 1.4**

### Property 4: æ ¸å¿ƒæŒ‡æ ‡å¯¹æ¯”å®Œæ•´æ€§
*For any* comparison view of KPI card, the display should include all four core metrics (sales, SKU count, turnover rate, margin rate) with own-store value, competitor value, difference value, and difference percentage.
**Validates: Requirements 2.2, 2.3**

### Property 5: æŒ‡æ ‡å·®å¼‚è§†è§‰åé¦ˆè§„åˆ™
*For any* KPI metric, if own-store value < competitor value, the Dashboard should display a red color or down arrow indicator; if own-store value > competitor value, the Dashboard should display a green color or up arrow indicator.
**Validates: Requirements 2.4, 2.5**

### Property 6: é›·è¾¾å›¾åŒæ›²çº¿æ¸²æŸ“
*For any* comparison view with valid KPI data, the radar chart should contain exactly two data curves (one for own-store, one for competitor) with different colors and a legend.
**Validates: Requirements 2.6**

### Property 7: å·®å¼‚åˆ†æè‡ªåŠ¨ç”Ÿæˆ
*For any* comparison view, the Dashboard should automatically generate difference analysis insights when competitor metrics exceed own-store metrics.
**Validates: Requirements 2.7, 5.1, 5.2**

### Property 8: åˆ†ç»„æŸ±çŠ¶å›¾åŒç³»åˆ—æ¸²æŸ“
*For any* category comparison data, the grouped bar chart should contain exactly two data series (own-store and competitor) displayed side-by-side with different colors and a legend.
**Validates: Requirements 3.2, 3.4, 7.1**

### Property 9: é•œåƒæŸ±çŠ¶å›¾å¸ƒå±€è§„åˆ™
*For any* category comparison data, the mirror bar chart should display own-store data on the left side (negative values) and competitor data on the right side (positive values) with a zero baseline in the middle.
**Validates: Requirements 3.3, 4.2, 7.2**

### Property 10: åˆ†ç±»çº§å·®å¼‚è¯†åˆ«
*For any* category where competitor metric > own-store metric, the Dashboard should generate a difference insight indicating the gap and improvement suggestions.
**Validates: Requirements 3.6**

### Property 11: å †å å›¾ç»“æ„å®Œæ•´æ€§
*For any* multi-spec comparison data, the stacked comparison bar chart should display two components (single-spec and multi-spec) for both own-store and competitor, with percentages shown.
**Validates: Requirements 4.3, 7.3**

### Property 12: å·®å¼‚æ´å¯Ÿæ•°é‡é™åˆ¶
*For any* difference analysis that generates more than 3 insights, the Dashboard should display only the top 3 most important insights.
**Validates: Requirements 5.5**

### Property 13: å·®å¼‚æ´å¯Ÿæ ¼å¼è§„èŒƒ
*For any* difference insight containing numerical values, the Dashboard should format it in a readable pattern like "Competitor's SKU count is 2x of own-store (20 vs 10)".
**Validates: Requirements 5.6**

### Property 14: ç«å¯¹æ•°æ®ç¼“å­˜æœºåˆ¶
*For any* competitor store, loading its data twice should result in the second load retrieving from cache rather than re-reading the Excel file.
**Validates: Requirements 6.2**

### Property 15: ç¼“å­˜æ›´æ–°ä¸€è‡´æ€§
*For any* competitor store switch operation, the Dashboard should clear the old competitor's cache and load the new competitor's data.
**Validates: Requirements 6.5**

### Property 16: æ»šåŠ¨ä½ç½®ä¿æŒ
*For any* comparison mode toggle operation, the Dashboard should maintain the current page scroll position after the view transition.
**Validates: Requirements 8.2**

### Property 17: å¢é‡æ›´æ–°æœºåˆ¶
*For any* competitor store switch operation, the Dashboard should only update comparison data without re-rendering the entire page layout.
**Validates: Requirements 8.3**

### Property 18: å›ºå®šæ§åˆ¶æ å®šä½
*For any* page scroll operation in comparison mode, the comparison control bar (mode switch and competitor selector) should remain fixed at the top of the viewport.
**Validates: Requirements 8.5**

## å®ç°è®¡åˆ’

### é˜¶æ®µ1ï¼šåŸºç¡€æ¶æ„ï¼ˆç¬¬1-2å‘¨ï¼‰

#### ä»»åŠ¡1.1ï¼šåˆ›å»ºå¯¹æ¯”æ¨¡å¼æ§åˆ¶æ 
- æ·»åŠ å¯¹æ¯”æ¨¡å¼å¼€å…³ï¼ˆSwitchç»„ä»¶ï¼‰
- æ·»åŠ ç«å¯¹é€‰æ‹©å™¨ï¼ˆDropdownç»„ä»¶ï¼‰
- å®ç°æ§åˆ¶æ çš„å›ºå®šå®šä½
- å®ç°å¼€å…³çŠ¶æ€ä¸é€‰æ‹©å™¨ç¦ç”¨/å¯ç”¨çš„è”åŠ¨
- _Validates: Requirements 1.1, 1.2, 1.3_

#### ä»»åŠ¡1.2ï¼šå®ç°å¯¹æ¯”æ•°æ®åŠ è½½å™¨
- åˆ›å»º`ComparisonDataLoader`ç±»
- å®ç°`load_competitor_data`æ–¹æ³•
- å®ç°ç¼“å­˜æœºåˆ¶ï¼ˆå†…å­˜ç¼“å­˜ï¼‰
- å®ç°ç¼“å­˜æ¸…é™¤åŠŸèƒ½
- _Validates: Requirements 6.1, 6.2, 6.5_

#### ä»»åŠ¡1.3ï¼šå®ç°çŠ¶æ€ç®¡ç†
- æ·»åŠ `dcc.Store`ç»„ä»¶å­˜å‚¨å¯¹æ¯”æ¨¡å¼çŠ¶æ€
- æ·»åŠ `dcc.Store`ç»„ä»¶å­˜å‚¨é€‰ä¸­çš„ç«å¯¹é—¨åº—
- æ·»åŠ `dcc.Store`ç»„ä»¶ç¼“å­˜ç«å¯¹æ•°æ®
- å®ç°çŠ¶æ€æ›´æ–°å›è°ƒ
- _Validates: Requirements 1.4_

#### ä»»åŠ¡1.4ï¼šå®ç°é”™è¯¯å¤„ç†æœºåˆ¶
- å¤„ç†ç«å¯¹æŠ¥å‘Šä¸å­˜åœ¨çš„æƒ…å†µ
- å¤„ç†æ•°æ®åŠ è½½å¤±è´¥çš„æƒ…å†µ
- å¤„ç†æ•°æ®æ ¼å¼ä¸åŒ¹é…çš„æƒ…å†µ
- æ·»åŠ é”™è¯¯æ—¥å¿—è®°å½•
- _Validates: Requirements 6.3_

### é˜¶æ®µ2ï¼šæ ¸å¿ƒå¡ç‰‡å¯¹æ¯”åŠŸèƒ½ï¼ˆç¬¬3-4å‘¨ï¼‰

#### ä»»åŠ¡2.1ï¼šå®ç°æ ¸å¿ƒæŒ‡æ ‡æ¦‚è§ˆå¯¹æ¯”
- åˆ›å»ºå¯¹æ¯”å¡ç‰‡ç»„ä»¶ï¼ˆ4ä¸ªæ ¸å¿ƒæŒ‡æ ‡ï¼‰
- å®ç°æŒ‡æ ‡å·®å¼‚è®¡ç®—
- å®ç°è§†è§‰åé¦ˆï¼ˆçº¢è‰²/ç»¿è‰²ï¼Œç®­å¤´ï¼‰
- åˆ›å»ºé›·è¾¾å›¾ç”Ÿæˆå‡½æ•°
- å®ç°å·®å¼‚åˆ†æç”Ÿæˆ
- _Validates: Requirements 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7_

#### ä»»åŠ¡2.1.1ï¼šç¼–å†™Propertyæµ‹è¯• - æŒ‡æ ‡å¯¹æ¯”å®Œæ•´æ€§
- **Property 4: æ ¸å¿ƒæŒ‡æ ‡å¯¹æ¯”å®Œæ•´æ€§**
- **Validates: Requirements 2.2, 2.3**

#### ä»»åŠ¡2.1.2ï¼šç¼–å†™Propertyæµ‹è¯• - è§†è§‰åé¦ˆè§„åˆ™
- **Property 5: æŒ‡æ ‡å·®å¼‚è§†è§‰åé¦ˆè§„åˆ™**
- **Validates: Requirements 2.4, 2.5**

#### ä»»åŠ¡2.1.3ï¼šç¼–å†™Propertyæµ‹è¯• - é›·è¾¾å›¾æ¸²æŸ“
- **Property 6: é›·è¾¾å›¾åŒæ›²çº¿æ¸²æŸ“**
- **Validates: Requirements 2.6**

#### ä»»åŠ¡2.2ï¼šå®ç°ä¸€çº§åˆ†ç±»åŠ¨é”€åˆ†æå¯¹æ¯”
- åˆ›å»ºåˆ†ç»„æŸ±çŠ¶å›¾ç”Ÿæˆå‡½æ•°ï¼ˆåŠ¨é”€ç‡ï¼‰
- åˆ›å»ºé•œåƒæŸ±çŠ¶å›¾ç”Ÿæˆå‡½æ•°ï¼ˆSKUæ•°é‡ï¼‰
- åˆ›å»ºåˆ†ç»„æŸ±çŠ¶å›¾ç”Ÿæˆå‡½æ•°ï¼ˆé”€å”®é¢ï¼‰
- å®ç°åˆ†ç±»çº§å·®å¼‚åˆ†æ
- é›†æˆåˆ°å¡ç‰‡å›è°ƒä¸­
- _Validates: Requirements 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7_

#### ä»»åŠ¡2.2.1ï¼šç¼–å†™Propertyæµ‹è¯• - åˆ†ç»„æŸ±çŠ¶å›¾æ¸²æŸ“
- **Property 8: åˆ†ç»„æŸ±çŠ¶å›¾åŒç³»åˆ—æ¸²æŸ“**
- **Validates: Requirements 3.2, 3.4**

#### ä»»åŠ¡2.2.2ï¼šç¼–å†™Propertyæµ‹è¯• - é•œåƒæŸ±çŠ¶å›¾å¸ƒå±€
- **Property 9: é•œåƒæŸ±çŠ¶å›¾å¸ƒå±€è§„åˆ™**
- **Validates: Requirements 3.3**

#### ä»»åŠ¡2.2.3ï¼šç¼–å†™Propertyæµ‹è¯• - åˆ†ç±»å·®å¼‚è¯†åˆ«
- **Property 10: åˆ†ç±»çº§å·®å¼‚è¯†åˆ«**
- **Validates: Requirements 3.6**

#### ä»»åŠ¡2.3ï¼šå®ç°å¤šè§„æ ¼å•†å“ä¾›ç»™åˆ†æå¯¹æ¯”
- åˆ›å»ºé•œåƒæŸ±çŠ¶å›¾ç”Ÿæˆå‡½æ•°ï¼ˆå¤šè§„æ ¼SKUæ•°é‡ï¼‰
- åˆ›å»ºå †å å¯¹æ¯”æŸ±çŠ¶å›¾ç”Ÿæˆå‡½æ•°ï¼ˆå æ¯”ï¼‰
- å®ç°å¤šè§„æ ¼ç»“æ„å·®å¼‚åˆ†æ
- é›†æˆåˆ°å¡ç‰‡å›è°ƒä¸­
- _Validates: Requirements 4.1, 4.2, 4.3, 4.4, 4.5, 4.6_

#### ä»»åŠ¡2.3.1ï¼šç¼–å†™Propertyæµ‹è¯• - å †å å›¾ç»“æ„
- **Property 11: å †å å›¾ç»“æ„å®Œæ•´æ€§**
- **Validates: Requirements 4.3**

### é˜¶æ®µ3ï¼šå·®å¼‚åˆ†æå¼•æ“ï¼ˆç¬¬5å‘¨ï¼‰

#### ä»»åŠ¡3.1ï¼šå®ç°å·®å¼‚åˆ†æç”Ÿæˆå™¨
- åˆ›å»º`DifferenceAnalyzer`ç±»
- å®ç°KPIå·®å¼‚åˆ†ææ–¹æ³•
- å®ç°åˆ†ç±»å·®å¼‚åˆ†ææ–¹æ³•
- å®ç°æ”¹è¿›å»ºè®®ç”Ÿæˆæ–¹æ³•
- _Validates: Requirements 5.1, 5.2, 5.3, 5.4_

#### ä»»åŠ¡3.2ï¼šå®ç°æ´å¯Ÿæ ¼å¼åŒ–å’Œé™åˆ¶
- å®ç°æ´å¯Ÿæ•°é‡é™åˆ¶ï¼ˆæœ€å¤š3æ¡ï¼‰
- å®ç°æ´å¯Ÿæ ¼å¼åŒ–è§„åˆ™
- å®ç°æ´å¯Ÿä¼˜å…ˆçº§æ’åº
- _Validates: Requirements 5.5, 5.6_

#### ä»»åŠ¡3.2.1ï¼šç¼–å†™Propertyæµ‹è¯• - æ´å¯Ÿæ•°é‡é™åˆ¶
- **Property 12: å·®å¼‚æ´å¯Ÿæ•°é‡é™åˆ¶**
- **Validates: Requirements 5.5**

#### ä»»åŠ¡3.2.2ï¼šç¼–å†™Propertyæµ‹è¯• - æ´å¯Ÿæ ¼å¼è§„èŒƒ
- **Property 13: å·®å¼‚æ´å¯Ÿæ ¼å¼è§„èŒƒ**
- **Validates: Requirements 5.6**

### é˜¶æ®µ4ï¼šäº¤äº’ä¼˜åŒ–å’Œæµ‹è¯•ï¼ˆç¬¬6å‘¨ï¼‰

#### ä»»åŠ¡4.1ï¼šä¼˜åŒ–è§†å›¾åˆ‡æ¢ä½“éªŒ
- å®ç°å¹³æ»‘è¿‡æ¸¡åŠ¨ç”»
- å®ç°æ»šåŠ¨ä½ç½®ä¿æŒ
- å®ç°å¢é‡æ›´æ–°æœºåˆ¶
- _Validates: Requirements 8.1, 8.2, 8.3_

#### ä»»åŠ¡4.1.1ï¼šç¼–å†™Propertyæµ‹è¯• - æ»šåŠ¨ä½ç½®ä¿æŒ
- **Property 16: æ»šåŠ¨ä½ç½®ä¿æŒ**
- **Validates: Requirements 8.2**

#### ä»»åŠ¡4.1.2ï¼šç¼–å†™Propertyæµ‹è¯• - å¢é‡æ›´æ–°
- **Property 17: å¢é‡æ›´æ–°æœºåˆ¶**
- **Validates: Requirements 8.3**

#### ä»»åŠ¡4.2ï¼šå®ç°åŠ è½½çŠ¶æ€åé¦ˆ
- æ·»åŠ åŠ è½½åŠ¨ç”»ç»„ä»¶
- å®ç°åŠ è½½è¶…æ—¶æ£€æµ‹ï¼ˆ2ç§’ï¼‰
- å®ç°è¿›åº¦æç¤º
- _Validates: Requirements 6.4, 8.4_

#### ä»»åŠ¡4.3ï¼šé›†æˆæµ‹è¯•å’Œæ€§èƒ½ä¼˜åŒ–
- ç¼–å†™é›†æˆæµ‹è¯•ç”¨ä¾‹
- æµ‹è¯•å®Œæ•´å¯¹æ¯”æµç¨‹
- ä¼˜åŒ–æ•°æ®åŠ è½½æ€§èƒ½
- ä¼˜åŒ–å›¾è¡¨æ¸²æŸ“æ€§èƒ½
- _Validates: All requirements_

#### ä»»åŠ¡4.4ï¼šCheckpoint - ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
- ç¡®ä¿æ‰€æœ‰Propertyæµ‹è¯•é€šè¿‡
- ç¡®ä¿æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡
- ç¡®ä¿æ€§èƒ½æµ‹è¯•é€šè¿‡
- å¦‚æœ‰é—®é¢˜ï¼Œå‘ç”¨æˆ·æŠ¥å‘Š

### é˜¶æ®µ5ï¼šæ–‡æ¡£å’Œéƒ¨ç½²ï¼ˆç¬¬7å‘¨ï¼‰

#### ä»»åŠ¡5.1ï¼šç¼–å†™ç”¨æˆ·æ–‡æ¡£
- ç¼–å†™åŠŸèƒ½ä½¿ç”¨æŒ‡å—
- ç¼–å†™å¸¸è§é—®é¢˜è§£ç­”
- å½•åˆ¶æ¼”ç¤ºè§†é¢‘

#### ä»»åŠ¡5.2ï¼šä»£ç å®¡æŸ¥å’Œä¼˜åŒ–
- ä»£ç å®¡æŸ¥
- æ€§èƒ½ä¼˜åŒ–
- å®‰å…¨æ£€æŸ¥

#### ä»»åŠ¡5.3ï¼šéƒ¨ç½²å’ŒéªŒæ”¶
- éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- ç”¨æˆ·éªŒæ”¶æµ‹è¯•
- æ”¶é›†åé¦ˆ

## é™„å½•

### A. å›¾è¡¨åº“é€‰æ‹©

ä½¿ç”¨Plotlyä½œä¸ºå›¾è¡¨åº“ï¼ŒåŸå› ï¼š
- âœ… å·²åœ¨é¡¹ç›®ä¸­ä½¿ç”¨
- âœ… æ”¯æŒæ‰€æœ‰éœ€è¦çš„å›¾è¡¨ç±»å‹
- âœ… äº¤äº’æ€§å¼º
- âœ… æ€§èƒ½è‰¯å¥½

### B. æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³• |
|-----|-------|---------|
| ç«å¯¹æ•°æ®åŠ è½½æ—¶é—´ | < 2ç§’ | è®¡æ—¶å™¨ |
| å›¾è¡¨æ¸²æŸ“æ—¶é—´ | < 0.5ç§’ | è®¡æ—¶å™¨ |
| ç¼“å­˜å‘½ä¸­ç‡ | > 90% | æ—¥å¿—ç»Ÿè®¡ |
| è§†å›¾åˆ‡æ¢æ—¶é—´ | < 0.3ç§’ | è®¡æ—¶å™¨ |

### C. å…¼å®¹æ€§

| æµè§ˆå™¨ | æœ€ä½ç‰ˆæœ¬ |
|-------|---------|
| Chrome | 90+ |
| Firefox | 88+ |
| Edge | 90+ |
| Safari | 14+ |

### D. ä¾èµ–é¡¹

æ— éœ€æ–°å¢ä¾èµ–ï¼Œä½¿ç”¨ç°æœ‰çš„ï¼š
- Dash
- Plotly
- Pandas
- NumPy
