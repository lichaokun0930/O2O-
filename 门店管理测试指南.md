# 门店管理测试指南

## ✅ 当前状态

阶段1（基础架构）已完成，门店管理优化已完成。现在可以开始测试功能。

---

## 📁 目录结构确认

已创建的目录：
```
reports/
├── 本店/                              ✅ 已创建
│   └── 惠宜选-铜山万达（5）_分析报告.xlsx  ✅ 已存在
│
└── 竞对门店/                          ✅ 已创建
    └── 江小囤-金鹰店（8）_分析报告.xlsx    ✅ 已存在
```

---

## 🧪 测试步骤

### 1. 启动Dashboard

```bash
python dashboard_v2.py
```

### 2. 检查Console日志

启动时应该看到：
```
🔍 开始自动发现门店报告...
  ✅ 发现本店: 惠宜选-铜山万达（5）
  ✅ 发现竞对: 江小囤-金鹰店（8）
📍 默认门店设置为: 惠宜选-铜山万达（5）
🎉 自动发现完成: 本店 1 个, 竞对 1 个
```

### 3. 测试TAB切换门店逻辑（新增）

1. 确保当前在"本店数据看板"TAB
2. 查看"门店切换"下拉框，应该显示：🏪 惠宜选-铜山万达（5）
3. 点击"竞对数据看板"TAB
4. 门店切换下拉框应该自动切换为：🎯 江小囤-金鹰店（8）
5. 切换回"本店数据看板"TAB
6. 门店切换下拉框应该恢复为：🏪 惠宜选-铜山万达（5）

### 4. 测试对比模式开关

1. 在"本店数据看板"TAB中找到顶部的"对比模式"开关
2. 点击开关，应该变为"ON"
3. 检查"选择竞对"下拉框是否启用
4. 检查下拉框中是否显示：🎯 江小囤-金鹰店（8）

### 5. 测试竞对数据加载

1. 从"选择竞对"下拉框中选择竞对门店
2. 打开浏览器开发者工具（F12）
3. 查看Console标签，应该看到：
```
🔍 开始加载竞对数据: 江小囤-金鹰店（8）
✅ 竞对数据加载成功: 江小囤-金鹰店（8）
📊 KPI数据: X 项
📊 分类数据: X 条
```

### 7. 测试缓存机制

1. 关闭对比模式（开关变为OFF）
2. 再次开启对比模式
3. 再次选择同一个竞对门店
4. 查看Console，应该看到：
```
✅ 使用缓存的竞对数据: 江小囤-金鹰店（8）
```

### 8. 测试新数据上传（可选）

#### 测试本店上传：
1. 在"数据上传"TAB中上传新的原始数据
2. 等待分析完成
3. 检查 `reports/本店/` 目录下是否生成新的报告文件
4. 文件名格式应为：`门店名称_分析报告.xlsx`

#### 测试竞对上传：
1. 在"竞对数据上传"TAB中上传竞对数据
2. 等待分析完成
3. 检查 `reports/竞对门店/` 目录下是否生成新的报告文件
4. 文件名格式应为：`门店名称_分析报告.xlsx`

---

## ✅ 预期结果

- ✅ TAB切换时门店列表自动更新（新增）
- ✅ 本店TAB显示本店列表（新增）
- ✅ 竞对TAB显示竞对列表（新增）
- ✅ 对比模式开关正常工作
- ✅ 竞对选择器正常显示竞对门店列表
- ✅ 竞对数据能够成功加载
- ✅ 缓存机制正常工作（第二次加载同一门店时使用缓存）
- ✅ 日志记录详细清晰
- ✅ 无JavaScript错误
- ✅ 新上传的本店数据保存到 `reports/本店/`
- ✅ 新上传的竞对数据保存到 `reports/竞对门店/`

---

## ❌ 常见问题排查

| 问题 | 可能原因 | 解决方法 |
|-----|---------|---------|
| TAB切换后门店列表不更新 | 回调未触发 | 检查Console是否有错误，重启Dashboard |
| 竞对TAB显示"暂无竞对数据" | 没有竞对门店 | 上传至少1个竞对数据 |
| 竞对选择器为空 | 只有1个门店或没有竞对 | 上传至少1个竞对数据 |
| 数据加载失败 | 报告文件不存在或损坏 | 检查reports目录下是否有完整的报告文件 |
| 缓存不生效 | ComparisonDataLoader未初始化 | 重启Dashboard |
| 开关无响应 | 回调函数未注册 | 检查Console是否有错误 |
| 启动时没有发现门店 | 文件名格式不正确 | 确保文件名包含"_分析报告.xlsx" |

---

## 📋 下一步

测试通过后，可以继续实现阶段2的任务：

### 阶段2：核心卡片对比功能

#### 任务5：创建对比卡片组件
- 在DashboardComponents类中创建 `create_kpi_comparison_cards` 方法
- 显示4个核心指标的对比卡片（销售额、SKU数、动销率、毛利率）
- 实现视觉反馈（红色/绿色，箭头）

#### 任务6：创建雷达图生成函数
- 在ComparisonChartBuilder类中创建 `create_radar_chart` 方法
- 归一化数据到0-100范围
- 创建双曲线雷达图

#### 任务7：实现核心指标对比视图回调
- 修改 `update_kpi_cards` 回调
- 检查对比模式状态
- 返回单店视图或对比视图

---

## 📝 测试反馈

请在测试后反馈以下信息：

1. ✅ 对比模式开关是否正常？
2. ✅ 竞对选择器是否显示正确的门店列表？
3. ✅ 竞对数据是否成功加载？
4. ✅ 缓存机制是否生效？
5. ✅ 是否有任何错误或异常？

如果测试通过，我们就可以继续实现阶段2的核心卡片对比功能！
